<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A Midnight Dreary Riddle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet" />
    <style>
        /* THEME & TYPOGRAPHY */
        html, body {
            margin: 0;
            padding: 0;
            background-color: #1D1D1D; /* Eerie Black */
            color: #F1E9D2;            /* Parchment */
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;          /* Prevent default scrollbars */
        }
        .font-didone {
            font-family: 'Playfair Display', serif;
            font-style: italic; /* Italicize the entire poem */
        }
        .text-blood-red { color: #8A0303; } /* Blood Red */

        /* ATMOSPHERIC EFFECTS */
        .vignette { display: none !important; }
        .vignette, .noise-texture {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 10;
        }
        .vignette {
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.95) 150%);
            mix-blend-mode: multiply;
            animation: pulseVignette 8s infinite;
        }
        @keyframes pulseVignette {
            0%, 100% { background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.95) 150%); }
            50%      { background: radial-gradient(circle, transparent 35%, rgba(0,0,0,0.9) 150%); }
        }
        .noise-texture {
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><filter id="f"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23f)"/></svg>');
            opacity: 0.05;
            animation: flicker 10s infinite linear;
            z-index: -1;
        }
        @keyframes flicker { 0%,100%{opacity:.05} 50%{opacity:.08} }

        /* UI ELEMENT STYLING */
        .riddle-input {
            background-color: transparent;
            border: none;
            border-bottom: 1px solid rgba(241,233,210,0.5);
            color: #F1E9D2;
            transition: all .3s ease;
            border-radius: 0;
        }
        .riddle-input:focus {
            outline: none;
            border-bottom-color: #F1E9D2;
            box-shadow: 0 10px 15px -10px rgba(241,233,210,0.2);
        }
        .riddle-button {
            background-color: transparent;
            border: none;
            color: #F1E9D2;
            transition: all .3s ease;
        }
        .riddle-button:hover, .riddle-button:focus {
            color: #390D3E; /* Tyrian Purple */
            transform: scale(1.1);
        }

        /* LAYOUT & SCROLLING */

        /* Use SAFE viewport height so iOS toolbars don't break centering */
        #scroll-container {
            width: 100%;
            height: 100svh;                 /* CHANGED: was 100vh */
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }

        .stanza-section {
            width: 100%;
            min-height: 100svh;             /* CHANGED: was height:100vh */
            scroll-snap-align: start;
            display: flex;
            align-items: center;            /* vertical centering */
            justify-content: center;
            flex-shrink: 0;
            padding: 0 2rem 6rem;           /* CHANGED: reserve space for arrow */
            position: relative;             /* for safety if you ever position children */
            box-sizing: border-box;
        }

        /* stanza container */
        .stanza-section .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            box-sizing: border-box;
        }

        /* Typography */
        .stanza-section p {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            line-height: 1.3;
            white-space: pre-line;
            margin: 0 auto;
            text-align: center;
            font-feature-settings: "hist", "ss01";
            font-variant-ligatures: common-ligatures historical-ligatures;
            letter-spacing: 0.03em;
            max-width: 38ch;
            padding: 0 1rem;
        }
        .stanza-section p span:first-of-type {
            font-size: 1.2em;
            font-weight: 500;
        }

        /* SCROLL ARROW STYLING (overlayed on viewport) */
        .scroll-arrow {
            position: absolute;
            left: 50%;
            bottom: 1.25rem;                /* tiny extra breathing room */
            transform: translateX(-50%);
            font-size: 2.5rem;
            color: #F1E9D2;
            cursor: pointer;
            animation: bounce 2s infinite;
            z-index: 20;
            line-height: 1;
            user-select: none;
        }
        @keyframes bounce {
            0%,20%,50%,80%,100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        /* OPTIONAL: per-slide micro-nudges (example) */
        /* .stanza-section[data-index="1"] .container { transform: translateY(-2vh); } */
    </style>
</head>
<body>
    <!-- Atmospheric Elements -->
    <div class="noise-texture"></div>
    <div class="vignette"></div>

    <!-- Main scroll container -->
    <div id="scroll-container">
        <!-- Stanza sections will be injected here -->
    </div>

    <!-- Feedback Message Box (remains fixed) -->
    <div id="message-box" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-70 flex items-center justify-center opacity-0 invisible transition-opacity duration-500 z-50">
        <div id="message-content" class="bg-[#1D1D1D] border border-[#313131] p-8 rounded-lg shadow-2xl text-center max-w-md">
            <p id="message-text" class="text-2xl font-didone"></p>
        </div>
    </div>

    <!-- GSAP Animation Library (core only) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        const riddleStanzas = [
`From the silence, darkly spoken,<br>
 Threads of riddles left unbroken,<br>
 Every word a cryptic token,<br>
 After night's plutonian shore.`,
`Came said fowl vis'tor tapping,<br>
 On your thoughts its talons rapping,<br>
 Raven perched on Pallas, asking <br>
 For some name not said before.<br>
 Till you answer nothing more.`,
`"Tell me, dreamer, tell me, guesser,<br>
 Dare you name your dark addressor?<br>
 Quint and quaint this swarth proffeser<br>
 Named in Poe's hymns evermore.`,
`Sit you now, engage in guessing,<br>
 Only one syllable expressed inâ€”<br>
 Name in repetend is dressed in<br>
 Say the name I hunger for,<br>
 My name is not, <strong>NEVERMORE."</strong>`
        ];

        // Create utility for input validation
        const validateInput = {
            c: atob('UXVvdGg='), // "Quoth"
            p: (s) => {
                let x = s.toLowerCase();
                if (x === atob('Y2hlYXRlciBjaGVhdGVyIHBvb3BvbyBlYXRlcg==')) {
                    return 'inspect';
                }
                return x === validateInput.c.toLowerCase();
            }
        };

        // --- UI ELEMENTS ---
        const scrollContainer = document.getElementById('scroll-container');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        let currentAnimation = null;

        // --- ADD SCROLL ARROW ---
        const scrollArrow = document.createElement('div');
        scrollArrow.className = 'scroll-arrow';
        scrollArrow.innerHTML = '&#x2193;';
        document.body.appendChild(scrollArrow);
        scrollArrow.addEventListener('click', () => {
            const currentScroll = scrollContainer.scrollTop;
            const sectionHeight = window.innerHeight;
            scrollContainer.scrollTo({ top: currentScroll + sectionHeight, behavior: 'smooth' });
        });

        // Hide arrow while scrolling; show again after scroll stops if not on guess/final section
        let scrollTimeout;
        scrollContainer.addEventListener('scroll', () => {
            scrollArrow.style.display = 'none';
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const currentScroll = scrollContainer.scrollTop;
                const sectionHeight = window.innerHeight;
                const currentIndex = Math.round(currentScroll / sectionHeight);
                if (currentIndex < riddleStanzas.length) {
                    scrollArrow.style.display = '';
                } else {
                    scrollArrow.style.display = 'none';
                }
            }, 200);
        });

        // --- ANIMATION & LOGIC ---
        function initializeExperience() {
            createStanzaSections();
            setupObservers();
            setupNavigation();
        }

        function createStanzaSections() {
            riddleStanzas.forEach((stanzaHTML, index) => {
                const section = document.createElement('section');
                section.className = 'stanza-section';
                section.dataset.index = index;
                section.innerHTML = `
                    <div class="container">
                        <p class="font-didone"></p>
                    </div>
                `;
                scrollContainer.appendChild(section);
            });

            // Create guess section
            const guessSection = document.createElement('section');
            guessSection.className = 'stanza-section';
            guessSection.dataset.index = riddleStanzas.length;
            guessSection.innerHTML = `
                <div id="guess-area" class="container opacity-0 flex flex-col items-center">
                    <input type="text" id="guess-input" class="riddle-input font-didone text-2xl w-full max-w-xs p-3 text-center" placeholder="Say my name." autocomplete="off">
                    <button id="guess-button" class="riddle-button mt-6 text-4xl leading-none tracking-widest">...</button>
                </div>
            `;
            scrollContainer.appendChild(guessSection);
        }

        function setupObservers() {
            const sections = document.querySelectorAll('.stanza-section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.classList.contains('is-visible')) {
                        entry.target.classList.add('is-visible');
                        const index = parseInt(entry.target.dataset.index);
                        if (index < riddleStanzas.length) {
                            animateStanza(entry.target, riddleStanzas[index]);
                        } else {
                            gsap.to(entry.target.querySelector('#guess-area'), {
                                duration: 1.5,
                                opacity: 1,
                                ease: 'power2.out'
                            });
                        }
                    }
                });
            }, { threshold: 0.6 });

            sections.forEach(section => observer.observe(section));
        }

        function animateStanza(section, stanzaHTML) {
            if (currentAnimation) currentAnimation.kill();

            const p = section.querySelector('p');
            p.innerHTML = stanzaHTML;

            const spansToAnimate = [];

            function wrapCharacters(parentElement) {
                const nodes = Array.from(parentElement.childNodes);
                nodes.forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        const text = node.textContent;
                        const fragment = document.createDocumentFragment();

                        // Split by line breaks first
                        const lines = text.split(/(<br>|\n)/g);

                        lines.forEach((line) => {
                            if (line.match(/<br>|\n/)) {
                                fragment.appendChild(document.createElement('br'));
                                return;
                            }

                            // Split line into words
                            const words = line.split(/(\s+)/);

                            words.forEach((word) => {
                                if (word.trim() === '') {
                                    fragment.appendChild(document.createTextNode(word));
                                } else {
                                    const wordSpan = document.createElement('span');
                                    wordSpan.style.display = 'inline-block';
                                    wordSpan.style.whiteSpace = 'nowrap';

                                    for (const char of word) {
                                        const span = document.createElement('span');
                                        span.textContent = char;
                                        span.style.display = 'inline-block';
                                        if (char.trim() !== '') spansToAnimate.push(span);
                                        wordSpan.appendChild(span);
                                    }
                                    fragment.appendChild(wordSpan);
                                }
                            });
                        });

                        parentElement.replaceChild(fragment, node);
                    } else if (node.nodeType === Node.ELEMENT_NODE) {
                        wrapCharacters(node);
                    }
                });
            }

            wrapCharacters(p);

            gsap.set(spansToAnimate, {
                opacity: 0,
                color: '#F1E9D2',
                textShadow: '0 0 15px rgba(241, 233, 210, 0.8)'
            });

            currentAnimation = gsap.to(spansToAnimate, {
                duration: 0.3,
                opacity: 1,
                textShadow: '0 0 0 rgba(241, 233, 210, 0)',
                stagger: 0.03,
                ease: 'power2.out',
                onComplete: () => { currentAnimation = null; }
            });
        }

        function setupNavigation() {
            let isAnimating = false;

            const navigate = () => {
                if (isAnimating) return;

                if (currentAnimation) {
                    isAnimating = true;
                    currentAnimation.progress(1).then(() => {
                        const currentScroll = scrollContainer.scrollTop;
                        const sectionHeight = window.innerHeight;
                        const nextScroll = Math.round(currentScroll / sectionHeight) * sectionHeight + sectionHeight;
                        if (nextScroll < scrollContainer.scrollHeight) {
                            scrollContainer.scrollTo({ top: nextScroll, behavior: 'smooth' });
                        }
                        isAnimating = false;
                    });
                } else {
                    const currentScroll = scrollContainer.scrollTop;
                    const sectionHeight = window.innerHeight;
                    const nextScroll = Math.round(currentScroll / sectionHeight) * sectionHeight + sectionHeight;
                    if (nextScroll < scrollContainer.scrollHeight) {
                        scrollContainer.scrollTo({ top: nextScroll, behavior: 'smooth' });
                    }
                }
            };

            let timeout;
            scrollContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'INPUT' || e.target.closest('button')) return;
                clearTimeout(timeout);
                timeout = setTimeout(navigate, 100);
            });

            const guessButton = document.getElementById('guess-button');
            const guessInput = document.getElementById('guess-input');
            guessButton.addEventListener('click', checkAnswer);
            guessInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') checkAnswer();
            });
        }

        // Actual answer validation using a hash
        function checkAnswer() {
            const guessInput = document.getElementById('guess-input');
            const result = validateInput.p(guessInput.value.trim());

            if (result === 'inspect') {
                showFeedback("A good riddle is sometimes a puzzle in words, other times a magician's trick. And sometimes... it's a trap for the impatient.");
            } else if (result === true) {
                handleCorrectAnswer();
            } else {
                showFeedback("That is not the word whispered on the bleak winds. Try again.");
            }
        }

        async function handleCorrectAnswer() {
            // Hide arrow for the final sequence
            scrollArrow.style.display = 'none';

            await gsap.to(scrollContainer, { duration: 1, opacity: 0, ease: 'power2.in' });

            scrollContainer.innerHTML = '';
            const finalSection = document.createElement('section');
            finalSection.className = 'stanza-section';
            finalSection.innerHTML = `
                <div class="container mx-auto p-8 text-center max-w-3xl">
                    <p id="final-message" class="font-didone text-3xl md:text-4xl lg:text-5xl leading-relaxed text-blood-red"></p>
                </div>
            `;
            scrollContainer.appendChild(finalSection);

            scrollContainer.scrollTo({ top: 0 });
            gsap.to(scrollContainer, { duration: 1, opacity: 1, ease: 'power2.out' });

            const finalMessageP = document.getElementById('final-message');
            const messageParts = [
                { text: "The devil told you that.", type: 'furious' },
                { text: "Very Well...", type: 'resigned' },
                { text: "One Moment.", type: 'normal' }
            ];

            for (const part of messageParts) {
                const partEl = document.createElement('div');
                partEl.style.display = 'block';
                if (messageParts.indexOf(part) > 0) partEl.style.marginTop = '1.5rem';
                finalMessageP.appendChild(partEl);

                const words = part.text.split(' ');
                const charsToAnimate = [];

                words.forEach((word) => {
                    const wordSpan = document.createElement('span');
                    wordSpan.style.display = 'inline-block';
                    wordSpan.style.marginRight = '0.75em';

                    for (const char of word) {
                        const span = document.createElement('span');
                        span.textContent = char;
                        span.style.display = 'inline-block';
                        wordSpan.appendChild(span);
                        charsToAnimate.push(span);
                    }
                    partEl.appendChild(wordSpan);
                });

                if (part.type === 'furious') {
                    partEl.style.fontWeight = 'bold';
                    partEl.style.fontSize = '1.1em';
                    gsap.set(charsToAnimate, { opacity: 0 });
                    await gsap.to(charsToAnimate, {
                        duration: 0.2,
                        opacity: 1,
                        x: 'random(-5, 5)',
                        y: 'random(-5, 5)',
                        rotation: 'random(-10, 10)',
                        stagger: 0.015,
                        ease: 'power3.inOut'
                    });
                } else if (part.type === 'resigned') {
                    gsap.set(charsToAnimate, { opacity: 0, y: 20 });
                    await gsap.to(charsToAnimate, {
                        duration: 1.5,
                        opacity: 0.7,
                        y: 0,
                        stagger: 0.1,
                        ease: 'power2.out'
                    });
                } else {
                    gsap.set(charsToAnimate, { opacity: 0, textShadow: '0 0 20px #8A0303' });
                    await gsap.to(charsToAnimate, {
                        duration: 0.3,
                        opacity: 1,
                        textShadow: '0 0 0 #8A0303',
                        stagger: 0.04,
                        ease: 'power2.out'
                    });
                }

                await new Promise(resolve => setTimeout(resolve, part.type === 'normal' ? 1000 : 2000));
            }

            setTimeout(() => {
                window.location.href = 'https://aplipinski16.wixsite.com/boos-clues';
            }, 1000);
        }

        function showFeedback(text) {
            scrollArrow.style.display = 'none';

            messageText.innerHTML = "A good riddle is sometimes a puzzle in words, other times a magician's trick. That's incorrect.<br><br>Would you try me again?";

            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex justify-center items-center gap-16 mt-8';

            const tryAgainBtn = document.createElement('button');
            tryAgainBtn.textContent = 'I would';
            tryAgainBtn.className = 'riddle-button font-didone text-2xl tracking-wider';
            tryAgainBtn.style.color = '#F1E9D2';
            tryAgainBtn.style.transition = 'all 0.3s ease';
            tryAgainBtn.onmouseover = () => { tryAgainBtn.style.transform = 'scale(1.1)'; };
            tryAgainBtn.onmouseout  = () => { tryAgainBtn.style.transform = 'scale(1)'; };
            tryAgainBtn.onclick = () => {
                hideFeedback();
                scrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
                document.getElementById('guess-input').value = '';
            };

            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'I would not';
            closeBtn.className = 'riddle-button font-didone text-2xl tracking-wider';
            closeBtn.style.color = '#F1E9D2';
            closeBtn.style.transition = 'all 0.3s ease';
            closeBtn.onmouseover = () => { closeBtn.style.transform = 'scale(1.1)'; };
            closeBtn.onmouseout  = () => { closeBtn.style.transform = 'scale(1)'; };
            closeBtn.onclick = () => { window.close(); };

            buttonsContainer.appendChild(tryAgainBtn);
            buttonsContainer.appendChild(closeBtn);

            // Social Media Hints Section (moved below buttons)
            const socialHints = document.createElement('div');
            socialHints.className = 'mt-8 pt-6';
            socialHints.style.borderTop = '1px solid rgba(241, 233, 210, 0.15)';
            socialHints.innerHTML = `
                <p class="font-didone mb-4" style="color: #F1E9D2; opacity: 0.7; font-style: italic; font-size: 0.95rem;">
                    The visitor has left you a clue. Can you spot it?
                </p>
                <div class="flex justify-center items-center gap-6 flex-wrap">
                    <a href="https://www.instagram.com/therealboosclues" target="_blank" rel="noopener noreferrer"
                       class="social-link-btn"
                       style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px;
                              background: transparent; color: rgba(241, 233, 210, 0.6);
                              text-decoration: none; border-radius: 4px;
                              font-size: 0.85rem; transition: all 0.3s ease;
                              border: 1px solid rgba(241, 233, 210, 0.2);
                              font-family: 'Montserrat', sans-serif;"
                       onmouseover="this.style.color='#F1E9D2'; this.style.borderColor='rgba(241, 233, 210, 0.4)';"
                       onmouseout="this.style.color='rgba(241, 233, 210, 0.6)'; this.style.borderColor='rgba(241, 233, 210, 0.2)';">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                            <circle cx="12" cy="12" r="4"/>
                            <circle cx="17.5" cy="6.5" r="0.5" fill="currentColor"/>
                        </svg>
                        <span>Instagram</span>
                    </a>
                    <a href="https://www.tiktok.com/@therealboosclues" target="_blank" rel="noopener noreferrer"
                       class="social-link-btn"
                       style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px;
                              background: transparent; color: rgba(241, 233, 210, 0.6);
                              text-decoration: none; border-radius: 4px;
                              font-size: 0.85rem; transition: all 0.3s ease;
                              border: 1px solid rgba(241, 233, 210, 0.2);
                              font-family: 'Montserrat', sans-serif;"
                       onmouseover="this.style.color='#F1E9D2'; this.style.borderColor='rgba(241, 233, 210, 0.4)';"
                       onmouseout="this.style.color='rgba(241, 233, 210, 0.6)'; this.style.borderColor='rgba(241, 233, 210, 0.2)';">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span>TikTok</span>
                    </a>
                </div>
            `;

            const messageContent = document.querySelector('#message-content');
            messageContent.innerHTML = '';
            messageContent.className = 'bg-[#1D1D1D] border border-[#313131] p-12 rounded-lg shadow-2xl text-center max-w-2xl mx-4';
            messageContent.appendChild(messageText);
            messageContent.appendChild(buttonsContainer);
            messageContent.appendChild(socialHints);

            messageBox.classList.remove('invisible');
            gsap.to(messageBox, { duration: 0.5, opacity: 1 });
        }

        function hideFeedback() {
            gsap.to(messageBox, {
                duration: 0.5,
                opacity: 0,
                onComplete: () => {
                    messageBox.classList.add('invisible');
                    const currentScroll = scrollContainer.scrollTop;
                    const sectionHeight = window.innerHeight;
                    const currentIndex = Math.round(currentScroll / sectionHeight);
                    if (currentIndex < riddleStanzas.length) {
                        scrollArrow.style.display = '';
                    }
                }
            });
        }

        function enhanceImmersion() {
            // Custom Cursor
            const cursor = document.createElement('div');
            const cursorDot = document.createElement('div');
            cursor.className = 'custom-cursor';
            cursorDot.className = 'cursor-dot';
            document.body.appendChild(cursor);
            document.body.appendChild(cursorDot);

            document.addEventListener('mousemove', (e) => {
                gsap.to(cursor,    { duration: 0.23, left: e.clientX, top: e.clientY });
                gsap.to(cursorDot, { duration: 0.10, left: e.clientX, top: e.clientY });
            });

            function createParticle(x, y) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                document.body.appendChild(particle);

                gsap.set(particle, {
                    left: x, top: y,
                    width: gsap.utils.random(2, 6),
                    height: gsap.utils.random(2, 6),
                });

                gsap.to(particle, {
                    duration: gsap.utils.random(1, 3),
                    opacity: gsap.utils.random(0.1, 0.3),
                    y: y - gsap.utils.random(50, 100),
                    x: x + gsap.utils.random(-50, 50),
                    rotation: gsap.utils.random(-360, 360),
                    ease: "power2.out",
                    onComplete: () => particle.remove()
                });
            }

            let lastSpawn = 0;
            document.addEventListener('mousemove', (e) => {
                const now = Date.now();
                if (now - lastSpawn > 50) {
                    createParticle(e.clientX, e.clientY);
                    lastSpawn = now;
                }
            });

            document.querySelectorAll('.stanza-section p').forEach(stanza => {
                stanza.addEventListener('mousemove', (e) => {
                    const rect = stanza.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    gsap.to(stanza, {
                        duration: 0.5,
                        textShadow: `${(x - rect.width / 2) / 50}px ${(y - rect.height / 2) / 50}px 15px rgba(241, 233, 210, 0.3)`,
                        ease: "power2.out"
                    });
                });

                stanza.addEventListener('mouseleave', () => {
                    gsap.to(stanza, { duration: 0.5, textShadow: 'none', ease: "power2.out" });
                });
            });

            gsap.to('.stanza-section p', {
                y: 10,
                duration: 2,
                repeat: -1,
                yoyo: true,
                ease: "power1.inOut",
                stagger: { each: 0.5, from: "random" }
            });
        }

        enhanceImmersion();
        initializeExperience();
    });
    </script>
</body>
</html>
